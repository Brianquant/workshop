<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MeetUp â€“ Community Events</title>
  <meta name="description" content="Free community events in your city. RSVP in under a minute." />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="brand">MEETUP Â· COMMUNITY</div>
    <div class="hero">
      <h1>Easy-going events ğŸ’¬ğŸ¸ â€“ grab your free spot</h1>
      <p>This is a little pilot project to connect people in the same city and similar age â€“ local students, Erasmus students, trainees and new arrivals. ğŸŒ</p>
      <p>Weâ€™re testing small, relaxed events like cocktail nights, game evenings or culture hangouts where you can actually talk, laugh and meet people you might already walk past on campus, in town or at work. ğŸ¹ğŸ²</p>
      <p>Pick an event, drop your <strong>first name</strong>, <strong>email</strong> and a few quick details so we can match Erasmus students, locals and internationals for the best vibes. ğŸ¤</p>
      <p class="intro">Letâ€™s mash up cultures, mix groups and experience the city in its full, diverse potential together. âœ¨</p>
      <div class="controls">
        <input id="q" class="search" placeholder="Search: cocktails, networking, runningâ€¦" />
        <button class="btn" id="reset">Reset</button>
      </div>
    </div>
  </header>

  <section class="notice">
    <p>Quick heads-up: we only light up an event when enough people confirmed. That keeps things cozy and no one ends up sipping solo. Drop your name, reserve a spot and weâ€™ll email you the final date + details once the crew is ready. âœ‰ï¸âœ¨</p>
  </section>

  <main class="grid" id="grid"></main>

  <dialog id="signup">
    <div class="modal-head">
      <strong>Registration</strong>
      <button class="x" aria-label="Close" onclick="closeModal()">Ã—</button>
    </div>
    <form id="form" name="event-signup" class="modal-body" method="POST" data-netlify="true" netlify-honeypot="company" action="/">
      <!-- Netlify Forms: "event-signup" wird automatisch erfasst. -->
      <input type="hidden" name="event_title" id="event_title" />
      <div id="formFields" class="form-fields"></div>
      <!-- Spam-Honeypot (Netlify) -->
      <input type="hidden" name="form-name" value="event-signup" />
      <input type="text" name="company" style="display:none" tabindex="-1" autocomplete="off" />
      <p class="help">By sending the form you agree that we may use your data to organize these community events. Weâ€™ll email you the details (including any contributions) once the plan is set.</p>
      <div class="msg" id="msg"></div>
      <div class="modal-foot">
        <button type="button" class="btn" onclick="closeModal()">Cancel</button>
        <button type="submit" class="btn primary">Sign up for free</button>
      </div>
    </form>
  </dialog>

  <footer>
    Â© <span id="year"></span> MeetUp Â· <a href="#" id="impressum">Impressum</a> Â· <a href="#" id="privacy">Privacy</a>
  </footer>

  <script>
    const EVENTS = [
      {
        id: 'tiki-101',
        title: 'Tiki Cocktail Network Night',
        date: '2025-12-05',
        time: '19:00',
        city: 'MÃ¼nster',
        tags: ['Indoor', 'Networking'],
        spots: 8,
        paid: true,
        formMode: 'simple',
        source_hash: 'tiki-101',
        status: 'interest',
        description: 'We turn a cozy flatshare into a tiny tiki bar, shake up two easy cocktails and keep the circle small so everyone really connects â€“ you just chip in a small amount on the spot. ğŸğŸ¥‚'
      },
      {
        id: 'glw-201',
        title: 'Frosty GlÃ¼hwein Night am Aasee',
        date: '2025-12-06',
        time: '18:00',
        city: 'MÃ¼nster',
        tags: ['Outdoor', 'Social'],
        spots: 20,
        paid: false,
        formMode: 'full',
        source_hash: 'glw-201',
        status: 'interest',
        description: 'Join us for a chilled GlÃ¼hwein evening by the Aasee. We bring pots, cookers, cups and the first batch of hot drinks. Bring your own mulled wine or punch, heat it up with the shared gear and pass it around while we warm our hands, swap drinks and meet new people by the water. ğŸ”¥ğŸ·'
      },
      {
        id: 'pot-301',
        title: 'Global Potluck Mashup',
        date: '2025-12-09',
        time: '18:00',
        city: 'MÃ¼nster',
        tags: ['Food', 'Community'],
        spots: 24,
        paid: false,
        formMode: 'simple',
        extraQuestions: ['potluck'],
        source_hash: 'pot-301',
        status: 'interest',
        description: 'Imagine dishes from the Philippines, Uganda, Brazil & friends lining one long table. Bring a dish, taste a dozen more and get the full flavour tour once enough people are in. ğŸ²ğŸŒ'
      }
    ];
    const AGE_RANGE_OPTIONS = [
      { value: '16-20', label: '16â€“20' },
      { value: '21-25', label: '21â€“25' },
      { value: '26-30', label: '26â€“30' },
      { value: '31-35', label: '31â€“35' },
      { value: '36-plus', label: '36+' }
    ];
    const COMMUNITY_PROFILE_OPTIONS = [
      { value: 'erasmus', label: 'Erasmus / exchange student' },
      { value: 'local', label: 'Local student' },
      { value: 'new', label: 'New in town, want to meet people' },
      { value: 'working', label: 'Working here, want to meet people' },
      { value: 'other', label: 'Other' }
    ];
    const FORM_TEMPLATE_UNIFIED = [
      { type: 'text', name: 'first_name', label: 'Full name *', required: true, placeholder: 'e.g. Lea', width: 'half' },
      { type: 'email', name: 'email', label: 'Email', placeholder: 'you@uni.de', width: 'half' },
      { type: 'select', name: 'age_range', label: 'Age range *', required: true, placeholderOption: 'Select your age rangeâ€¦', options: AGE_RANGE_OPTIONS, width: 'full' },
      { type: 'select', name: 'current_situation', label: 'Current situation *', required: true, placeholderOption: 'Chooseâ€¦', options: COMMUNITY_PROFILE_OPTIONS, width: 'full' },
      { type: 'textarea', name: 'culture_wishlist', label: 'Any events from your culture (or others) youâ€™d love to see here?', rows: 4, placeholder: 'Dance nights (Salsa, Line Danceâ€¦), community cooking, games, music or film nights', hint: 'Tell us everything â€“ weâ€™re using your ideas to bring more culture & exchange to the city. ğŸŒ' },
      { type: 'checkbox', name: 'consent', label: 'I agree that my data may be used to contact me about this event and similar student events.', required: true },
      { type: 'hidden', name: 'source_hash', value: event => event?.source_hash || event?.id || '' }
    ];
    const EXTRA_FIELD_SETS = {
      potluck: [
        { type: 'textarea', name: 'favorite_dishes', label: 'Which dishes from other cultures would you love to try?', placeholder: 'Philippines: Adobo, Uganda: Rolex, Brazil: Feijoadaâ€¦' },
        { type: 'textarea', name: 'bring_dish', label: 'What dish would you bring to the potluck?', placeholder: 'Tell us what youâ€™d cook or bake', hint: 'Weâ€™ll email you the plan as soon as enough foodies have signed up.' }
      ]
    };

    const grid = document.getElementById('grid');
    const q = document.getElementById('q');
    const form = document.getElementById('form');
    const formFields = document.getElementById('formFields');
    const dlg = document.getElementById('signup');
    let activeEventId = null;

    function resolveOptions(opts, event) {
      if (typeof opts === 'function') return opts(event) || [];
      return opts || [];
    }

    function buildField(config, event) {
      const wrapper = document.createElement('div');
      const widthClass = config.width === 'half' ? 'half' : 'full';
      wrapper.className = `field ${widthClass}`;

      if (config.type === 'hidden') {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = config.name;
        input.value = typeof config.value === 'function' ? config.value(event) : (config.value || '');
        wrapper.style.display = 'none';
        wrapper.appendChild(input);
        return wrapper;
      }

      const id = `${config.name}-${Math.random().toString(36).slice(2, 7)}`;
      if (config.type === 'checkbox') {
        const label = document.createElement('label');
        const input = document.createElement('input');
        input.type = 'checkbox';
        input.id = id;
        input.name = config.name;
        if (config.required) input.required = true;
        label.appendChild(input);
        const text = document.createTextNode(` ${config.label}`);
        label.appendChild(text);
        wrapper.appendChild(label);
        if (config.hint) {
          const hint = document.createElement('small');
          hint.textContent = config.hint;
          wrapper.appendChild(hint);
        }
        return wrapper;
      }

      if (config.type === 'checkbox-group') {
        const legend = document.createElement('p');
        legend.textContent = config.label;
        wrapper.appendChild(legend);
        const options = resolveOptions(config.options, event);
        options.forEach((opt, idx) => {
          const optionLabel = document.createElement('label');
          optionLabel.className = 'checkbox-option';
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.name = config.name;
          checkbox.value = opt.value;
          if (config.required) checkbox.required = true;
          optionLabel.appendChild(checkbox);
          optionLabel.appendChild(document.createTextNode(` ${opt.label}`));
          wrapper.appendChild(optionLabel);
        });
        if (config.hint) {
          const hint = document.createElement('small');
          hint.textContent = config.hint;
          wrapper.appendChild(hint);
        }
        return wrapper;
      }

      const label = document.createElement('label');
      label.setAttribute('for', id);
      label.textContent = config.label;
      wrapper.appendChild(label);

      let input;
      if (config.type === 'textarea') {
        input = document.createElement('textarea');
        input.rows = config.rows || 3;
      } else if (config.type === 'select') {
        input = document.createElement('select');
        const placeholder = document.createElement('option');
        placeholder.value = '';
        placeholder.textContent = config.placeholderOption || 'Chooseâ€¦';
        placeholder.disabled = true;
        placeholder.selected = true;
        input.appendChild(placeholder);
        resolveOptions(config.options, event).forEach(opt => {
          const option = document.createElement('option');
          option.value = opt.value;
          option.textContent = opt.label;
          input.appendChild(option);
        });
      } else {
        input = document.createElement('input');
        input.type = config.type || 'text';
        if (config.min !== undefined) input.min = config.min;
        if (config.max !== undefined) input.max = config.max;
      }
      input.id = id;
      input.name = config.name;
      if (config.required) input.required = true;
      if (config.placeholder && config.type !== 'select') input.placeholder = config.placeholder;
      wrapper.appendChild(input);

      if (config.hint) {
        const hint = document.createElement('small');
        hint.textContent = config.hint;
        wrapper.appendChild(hint);
      }
      return wrapper;
    }

    function renderFormFields(event) {
      let fields = FORM_TEMPLATE_UNIFIED.slice();
      (event?.extraQuestions || []).forEach(key => {
        if (EXTRA_FIELD_SETS[key]) fields = fields.concat(EXTRA_FIELD_SETS[key]);
      });
      if (!fields.length) fields = FORM_TEMPLATE_UNIFIED;
      formFields.innerHTML = '';
      fields.forEach(field => formFields.appendChild(buildField(field, event)));
    }

    function fmtDate(iso) {
      const d = new Date(iso + 'T00:00:00');
      return d.toLocaleDateString('en-GB', { weekday: 'short', day: '2-digit', month: 'short' });
    }

    function render(list) {
      grid.innerHTML = list.map(e => {
        let statusClass = 'upcoming';
        let statusLabel = 'Upcoming';
        if (e.status === 'planning') {
          statusClass = 'planning';
          statusLabel = 'In planning';
        } else if (e.status === 'interest') {
          statusClass = 'interest';
          statusLabel = 'Interest check';
        }
        return `
        <article class="card" data-id="${e.id}">
          <div class="meta">
            <span class="pill ${statusClass}">${statusLabel}</span>
            <span class="pill">${e.city}</span>
            <span class="pill">${e.spots} spots</span>
            <span class="pill ${e.paid ? 'paid' : 'free'}">${e.paid ? 'Paid experience' : 'Free'}</span>
          </div>
          <h3>${e.title}</h3>
          <p class="card-desc">${e.description}</p>
          <div class="meta">${e.tags.map(t => `<span class="pill">#${t}</span>`).join('')}</div>
          <div class="cta-row">
            <button class="btn primary" onclick="openModal('${e.id}')">Sign up âœï¸</button>
            <button class="btn ghost" onclick="share('${e.title.replace(/'/g, "&#39;")}')">Share ğŸ”—</button>
          </div>
        </article>
      `;
      }).join('');
    }

    function filter() {
      const term = q.value.trim().toLowerCase();
      if (!term) return render(EVENTS);
      const list = EVENTS.filter(e =>
        e.title.toLowerCase().includes(term) ||
        e.city.toLowerCase().includes(term) ||
        e.tags.join(' ').toLowerCase().includes(term)
      );
      render(list);
    }

    document.getElementById('reset').addEventListener('click', () => { q.value = ''; render(EVENTS); });
    q.addEventListener('input', filter);

    function openModal(eventId) {
      const event = EVENTS.find(e => e.id === eventId);
      activeEventId = event ? event.id : null;
      form.reset();
      renderFormFields(event);
      document.getElementById('event_title').value = event ? event.title : '';
      const msgEl = document.getElementById('msg');
      msgEl.className = 'msg';
      msgEl.textContent = '';
      dlg.showModal();
    }
    function closeModal() {
      dlg.close();
      form.reset();
      activeEventId = null;
    }
    window.closeModal = closeModal; window.openModal = openModal;

    async function handleSubmit(e) {
      e.preventDefault();
      const msg = document.getElementById('msg');

      const currentForm = e.target;
      if (!currentForm.reportValidity()) return;
      const data = new FormData(currentForm);
      if (!data.has('form-name') && currentForm.name) data.append('form-name', currentForm.name);
      const body = new URLSearchParams();
      data.forEach((value, key) => body.append(key, value));

      try {
        const res = await fetch(currentForm.action, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: body.toString()
        });
        if (res.ok) {
          currentForm.reset();
          msg.innerHTML = 'Thanks! Your free registration is in.';
          msg.className = 'msg ok';
        } else {
          msg.textContent = 'Whoops â€“ something went wrong. Please try again later.';
          msg.className = 'msg err';
        }
      } catch (err) {
        msg.textContent = 'Offline? Please check your internet connection.';
        msg.className = 'msg err';
      }
    }
    form.addEventListener('submit', handleSubmit);

    function share(title) {
      const text = `Join me at "${title}" â€“ free RSVP! ğŸ‰`;
      const url = location.href;
      if (navigator.share) navigator.share({ title: document.title, text, url });
      else navigator.clipboard.writeText(url).then(() => alert('Link copied!'));
    }
    window.share = share;

    renderFormFields(EVENTS[0]);
    render(EVENTS);
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
